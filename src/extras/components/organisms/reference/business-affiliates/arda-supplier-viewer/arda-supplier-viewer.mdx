import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Components/Extras/Organisms/Reference/Business Affiliates/ArdaSupplierViewer/Docs" />

# ArdaSupplierViewer

The `ArdaSupplierViewer` is the first reference implementation of the Phase 2 `createArdaEntityViewer` factory.
It provides a complete viewer/editor for the `BusinessAffiliate` entity with dual layout support.

## Overview

- **Entity:** `BusinessAffiliate`
- **Layouts:** Stepped (4-tab) and Continuous Scroll
- **Depth:** 4 levels (Affiliate &#8594; Contact &#8594; PostalAddress &#8594; GeoLocation)
- **Custom fields:** Business roles (checkbox group via `ArdaCustomFieldInteractive`)

## Factory Usage

The viewer is created by calling `createArdaEntityViewer` with a design-time configuration
and a field descriptor map:

```tsx
import { createArdaEntityViewer } from '@/extras/components/organisms/shared/entity-viewer';

const designConfig: DesignConfig<BusinessAffiliate> = {
  validate: validateBusinessAffiliate,
  get: getSupplier,
  update: updateSupplier,
  newInstance: createSupplierInstance,
  onExitWithSuccess: (entity) => console.log('Saved', entity),
  onExitWithErrors: (errors) => console.warn('Errors', errors),
};

const { Component: ArdaSupplierViewer } = createArdaEntityViewer<BusinessAffiliate>(
  designConfig,
  fieldDescriptors,
);
```

The factory returns `{ Component }` following the same convention as `createArdaEntityDataGrid`.

## Layout Configurations

### Stepped Layout (4 Tabs)

The stepped layout organises fields into four tabs:

<table>
  <thead>
    <tr>
      <th>Tab</th>
      <th>Fields</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Identity</strong></td>
      <td><code>eId</code>, <code>name</code>, <code>roles</code></td>
    </tr>
    <tr>
      <td><strong>Contact</strong></td>
      <td><code>contact</code> (ContactSubViewer)</td>
    </tr>
    <tr>
      <td><strong>Address &amp; Legal</strong></td>
      <td><code>mainAddress</code> (PostalAddressSubViewer), <code>legal</code> (CompanyInfoSubViewer)</td>
    </tr>
    <tr>
      <td><strong>Notes</strong></td>
      <td><code>notes</code></td>
    </tr>
  </tbody>
</table>

Tab definitions are exported from `configs/stepped-layout.ts` as `supplierTabs`.

### Continuous Scroll

In continuous-scroll mode all fields render in a single scrollable column in the order:
`eId` &#8594; `name` &#8594; `roles` &#8594; `contact` &#8594; `mainAddress` &#8594; `legal` &#8594; `notes`.

The field order array is exported from `configs/continuous-scroll-layout.ts` as `supplierFieldOrder`.

## Sub-Viewers

Three sub-viewer components handle nested types:

<table>
  <thead>
    <tr>
      <th>Sub-Viewer</th>
      <th>Nested Type</th>
      <th>Key Fields</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ContactSubViewer</code></td>
      <td><code>Contact</code></td>
      <td>Salutation, first/last name, job title, email, phone, nested postal address</td>
    </tr>
    <tr>
      <td><code>PostalAddressSubViewer</code></td>
      <td><code>PostalAddress</code></td>
      <td>Address lines, city, state, postal code, country (enum), geo-location display</td>
    </tr>
    <tr>
      <td><code>CompanyInfoSubViewer</code></td>
      <td><code>CompanyInformation</code></td>
      <td>Legal name, country (enum), tax ID, registration ID, NAICS code</td>
    </tr>
  </tbody>
</table>

Each sub-viewer implements `AtomProps<V>` and sets a `displayName` containing "SubViewer",
which allows the entity viewer shell to identify them as nested viewers.

## Validation

### Field-Level

- **Name:** required (non-empty string)
- **Roles:** at least one business role must be selected
- **Email:** validated for format in the entity-level validator
- **Tax ID:** validated for format in the entity-level validator

### Entity-Level

The `validateBusinessAffiliate` function compares previous and updated states, returning
both `fieldErrors` (with dot-path references like `contact.email`) and `entityErrors`
for cross-field constraints.

## Migration Notes

The `SupplierDrawer` and `SupplierForm` components now use `ArdaSupplierViewer` internally.
`SupplierForm` renders the viewer in continuous-scroll mode, while `SupplierDrawer`
uses the stepped layout with four tabs. Both components pass through their existing
props to the viewer's `MountConfig`.
